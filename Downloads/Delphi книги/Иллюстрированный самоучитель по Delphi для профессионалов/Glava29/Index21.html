<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<html>
<head>
<title>
</title>
<meta http-equiv="Content-Type" content="text/html;charset=windows-1251">
</head>
<body TEXT="#000000" BGCOLOR="#E7E3E7"  LINK="#004080" VLINK="#004080" olink="#008080">
<table COLS="3" WIDTH="16%">
<tr>
<td>
<font face="Verdana" size="3">
<a href="Index20.html">
<img SRC="Back.gif" BORDER="0">
</a>
</font>
</td>
<td WIDTH="10%">
<font face="Verdana" size="3">
<a href="../index.html">
<img SRC="Menu.gif" BORDER="0">
</a>
</font>
</td>
<td ALIGN="RIGHT">
<font face="Verdana" size="3">
<a href="Index22.html">
<img SRC="For.gif" BORDER="0">
</a>
</font>
</td>
</tr>
</table>
<P><font face="Verdana" size="3">
&nbsp;
</font ></P>
<p align="center">
<font face="Verdana" size="3">
<font size="4"> ак избежать одновременного запуска двух копий одного приложени€</font>
<br>
</font>
</P>
<p align="left">
<font face="Verdana" size="3">

</font ></P>
<P><font face="Verdana" size="3">
“ака€ задача возникает очень часто. ћногие, особенно начинающие, пользователи не вполне понимают, что между щелчком по значку приложени€ и его запуском может пройти несколько секунд, а то и дес€тков секунд. ќни начинают щелкать по значку, запуска€ все новые копии. ћежду тем, при работе с базами данных и во многих других случа€х иметь более одной копии не только не нужно, но и вредно.
</font ></P>
<P><font face="Verdana" size="3">
»де€ заключаетс€ в том, чтобы перва€ создаваема€ копи€ приложени€ захватывала некий, ресурс, а все последующие при запуске пытались сделать то же самое и в случае неудачи
завершались.
</font ></P>
<P><font face="Verdana" size="3">
ѕример такого ресурса Ч общий блок в файле, отображаемом в пам€ть. ѕоскольку этот ресурс имеет им€, можно сделать его уникальным именно дл€ вашего приложени€:
</font ></P>
<blockquote>
<P><font face="Verdana" size="3">
<font face="Verdana" size="2">
var UniqueMapping : THandle;</font>
</font ></P>
<P><font face="Verdana" size="3">
<font face="Verdana" size="2">
FirstWindow : THandle</font>
</font ></P>
<P><font face="Verdana" size="3">
<font face="Verdana" size="2">; begin</font>
</font ></P>
<P><font face="Verdana" size="3">
<font face="Verdana" size="2">
UniqueMapping := CreateFileMapping($ffffffff,&nbsp;</font>
</font ></P>
<P><font face="Verdana" size="3">
<font face="Verdana" size="2">nil, PAGE_READONLY, 0, 32,'MyMap');</font>
</font ></P>
<P><font face="Verdana" size="3">
<font face="Verdana" size="2">&nbsp;if UniqueMapping = 0 then</font>
</font ></P>
<P><font face="Verdana" size="3">
<font face="Verdana" size="2">&nbsp;begin</font>
</font ></P>
<P><font face="Verdana" size="3">
<font face="Verdana" size="2">ShowMessage(SysErrorMessage(GetLastError));</font>
</font ></P>
<P><font face="Verdana" size="3">
<font face="Verdana" size="2">Halt;</font>
</font ></P>
<P><font face="Verdana" size="3">
<font face="Verdana" size="2">&nbsp;end</font>
</font ></P>
<P><font face="Verdana" size="3">
<font face="Verdana" size="2">
else if GetLastError = ERROR_ALREADY_EXISTS then&nbsp;</font>
</font ></P>
<P><font face="Verdana" size="3">
<font face="Verdana" size="2"> begin</font>
</font ></P>
<P><font face="Verdana" size="3">
<font face="Verdana" size="2">
FirstWindow := FindWindowEx(0, 0, TfmMain.ClassName, nil);</font>
</font ></P>
<P><font face="Verdana" size="3">
<font face="Verdana" size="2">&nbsp;if FirstWindowoO then</font>
</font ></P>
<P><font face="Verdana" size="3">
<font face="Verdana" size="2">SetForegroundWindow(FirstWindow};</font>
</font ></P>
<P><font face="Verdana" size="3">
<font face="Verdana" size="2">&nbsp;Halt;</font>
</font ></P>
<P><font face="Verdana" size="3">
<font face="Verdana" size="2">&nbsp; end;</font>
</font ></P>
<P><font face="Verdana" size="3">
<font face="Verdana" size="2">
// Ќет других копий Ч продолжение Application.Initialize;</font>
</font ></P>
</blockquote>
<P><font face="Verdana" size="3">
ѕримерно такие строки нужно вставить в начало текста проекта до создани€ форм. Ѕлок совместно используемой пам€ти выдел€етс€ в системном страничном файле (об этом говорит первый параметр, равный -1, см. описание функции
<font face="Verdana" size="2">CreateFileMapping</font>). ≈го им€ Ч <font face="Verdana" size="2"> мућар</font>. ≈сли при создании блока будет получен код ошибки
<font face="Verdana" size="2">ERROR_ALREADY__EXISTS</font>, это свидетельствует о наличии работающей копии приложени€. ¬ этом случае приложение переключает фокус на главную форму другого экземпл€ра и завершаетс€; в противном случае процесс инициализации продолжаетс€.
</font ></P>
<P><font face="Verdana" size="3">
&nbsp;
</font ></P>
<table COLS="3" WIDTH="16%">
<tr>
<td>
<font face="Verdana" size="3">
<a href="Index20.html">
<img SRC="Back.gif" BORDER="0">
</a>
</font>
</td>
<td WIDTH="10%">
<font face="Verdana" size="3">
<a href="../index.html">
<img SRC="Menu.gif" BORDER="0">
</a>
</font>
</td>
<td ALIGN="RIGHT">
<font face="Verdana" size="3">
<a href="Index22.html">
<img SRC="For.gif" BORDER="0">
</a>
</font>
</td>
</tr>
</table>
</body>
</html>

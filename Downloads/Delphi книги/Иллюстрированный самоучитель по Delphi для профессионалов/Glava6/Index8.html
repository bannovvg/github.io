<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<html>
<head>
<title>
</title>
<meta http-equiv="Content-Type" content="text/html;charset=windows-1251">
</head>
<body TEXT="#000000" BGCOLOR="#E7E3E7"  LINK="#004080" VLINK="#004080" olink="#008080">
<table COLS="3" WIDTH="16%">
<tr>
<td>
<font face="Verdana" size="3">
<a href="Index7.html">
<img SRC="Back.gif" BORDER="0">
</a>
</font>
</td>
<td WIDTH="10%">
<font face="Verdana" size="3">
<a href="../index.html">
<img SRC="Menu.gif" BORDER="0">
</a>
</font>
</td>
<td ALIGN="RIGHT">
<font face="Verdana" size="3">
<a href="Index9.html">
<img SRC="For.gif" BORDER="0">
</a>
</font>
</td>
</tr>
</table>
<P><font face="Verdana" size="3">
&nbsp;
</font ></P>
<p align="center"> <font face="Verdana" size="3"> <strong>Theme 
  API</strong> <br>
</font>
</P>
<p align="left"><font face="Verdana" size="3">Помимо описанного способа создания 
  и управления визуальными стилями разработчик может использовать функции Theme 
  API, разработанные Microsoft для этих целей. </font ></P>
<P><font face="Verdana" size="3">
Для того чтобы использовать Theme API, можно стандартным способом подключить к проекту динамическую библиотеку Theme.dll:
</font ></P>
<blockquote>
<P><font face="Verdana" size="3">
<font face="Verdana" size="2">
var ThemeDLL: HINST;</font>
</font ></P>
<P><font face="Verdana" size="3">
<font face="Verdana" size="2">...</font>
</font ></P>
<P><font face="Verdana" size="3">
<font face="Verdana" size="2">
begin</font>
</font ></P>
<P><font face="Verdana" size="3">
<font face="Verdana" size="2">
ThemeDLL := LoadLibrary('theme.dll');</font>
</font ></P>
<P><font face="Verdana" size="3">
<font face="Verdana" size="2">&nbsp;if ThemeDLL &lt;&gt; 0 then</font>
</font ></P>
<P><font face="Verdana" size="3">
<font face="Verdana" size="2">&nbsp;begin</font>
</font ></P>
<P><font face="Verdana" size="3">
<font face="Verdana" size="2">...</font>
</font ></P>
<P><font face="Verdana" size="3">
<font face="Verdana" size="2">end;</font>
</font ></P>
<P><font face="Verdana" size="3">
<font face="Verdana" size="2">&nbsp;end;</font>
</font ></P>
</blockquote>
<P><font face="Verdana" size="3">
Затем можно использовать возможности этого программного интерфейса напрямую. С деталями его реализации вы можете ознакомиться в документации Microsoft MSDN.
</font ></P>
<P><font face="Verdana" size="3">
Однако можно поступить проще. В составе Delphi 7 имеется модуль Ux-Theme.pas, в котором как раз и реализованы возможности Theme API. Кроме этого, модуль Themes.pas содержит классы для основных элементов управления, которые могут использоваться при создании визуальных стилей, а также класс менеджера тем
<font face="Verdana" size="2">TThemeServices</font>.
</font ></P>
<P><font face="Verdana" size="3">
Так как детальное обсуждение возможностей Theme API выходит за рамки этой книги, в листинге 6.4 представлен схематичный пример использования функций этого программного интерфейса. Кроме того, как и все остальные API, работающие с GUI (Graphic User Interface) операционной системы, реальный код с использованием Theme API всегда перегружен многочисленными и ужасными на вид (а на самом деле вполне безобидными) функциями, рассчитывающими области вывода, неклиентские зоны оконных элементов и т. д.
</font ></P>
<P><font face="Verdana" size="3">
Поэтому наш пример лишь показывает, как загрузить динамическую библиотеку theme.dll и получить ссылку на тему визуального стиля для текущего окна и кнопочного элемента управления.
</font ></P>
<P align="center"><font face="Verdana" size="3"> <B>&nbsp;Листинг 6.4.</B> Пример 
  использования функций Theme API в Delphi&nbsp; </font ></P>
<blockquote>
<P><font face="Verdana" size="3">
<font face="Verdana" size="2">
var DC: HOC;</font>
</font ></P>
<P><font face="Verdana" size="3">
<font face="Verdana" size="2">
CurrentThemeData: HTHEME;</font>
</font ></P>
<P><font face="Verdana" size="3">
<font face="Verdana" size="2">
begin</font>
</font ></P>
<P><font face="Verdana" size="3">
<font face="Verdana" size="2">
if UseThemes and InitThemeLibrary then&nbsp;</font>
</font ></P>
<P><font face="Verdana" size="3">
<font face="Verdana" size="2"> try</font>
</font ></P>
<P><font face="Verdana" size="3">
<font face="Verdana" size="2">
DC := GetWindowDC(Handle) ;</font>
</font ></P>
<P><font face="Verdana" size="3">
<font face="Verdana" size="2">&nbsp;try CurrentThemeData := OpenThemeData(0, 'button');</font>
</font ></P>
<P><font face="Verdana" size="3">
<font face="Verdana" size="2">
CloseThemeData(CurrentThemeData);&nbsp;</font>
</font ></P>
<P><font face="Verdana" size="3">
<font face="Verdana" size="2"> finally</font>
</font ></P>
<P><font face="Verdana" size="3">
<font face="Verdana" size="2">
ReleaseDC(Handle, DC);&nbsp;</font>
</font ></P>
<P><font face="Verdana" size="3">
<font face="Verdana" size="2"> end finally</font>
</font ></P>
<P><font face="Verdana" size="3">
<font face="Verdana" size="2">
FreeThemeLibrary;&nbsp;</font>
</font ></P>
<P><font face="Verdana" size="3">
<font face="Verdana" size="2"> end else</font>
</font ></P>
<P><font face="Verdana" size="3">
<font face="Verdana" size="2">
ShowMessage('Приложение или операционная система не поддерживают использование Theme
API');</font>
</font ></P>
<P><font face="Verdana" size="3">
<font face="Verdana" size="2">&nbsp;end;</font>
</font ></P>
</blockquote>
<P><font face="Verdana" size="3">
Функция
</font ></P>
<blockquote>
<P><font face="Verdana" size="3">
<font face="Verdana" size="2">
function UseThemes: Boolean;</font>
</font ></P>
</blockquote>
<P><font face="Verdana" size="3">
проверяет способность операционной системы и приложения использовать Theme API.
</font ></P>
<P><font face="Verdana" size="3">
Методы
</font ></P>
<blockquote>
<P><font face="Verdana" size="3">
<font face="Verdana" size="2">
function InitThemeLibrary: Boolean;</font>
</font ></P>
<P><font face="Verdana" size="3">
<font face="Verdana" size="2">&nbsp;procedure FreeThemeLibrary;</font>
</font ></P>
</blockquote>
<P><font face="Verdana" size="3">
соответственно инициализируют и выгружают библиотеку theme.dll.
</font ></P>
<P><font face="Verdana" size="3">
Графический контекст ос наверняка понадобится при отрисовке элементов управления (см. гл. 10).
</font ></P>
<P><font face="Verdana" size="3">
Функция
</font ></P>
<blockquote>
<P><font face="Verdana" size="3">
<font face="Verdana" size="2">
OpenThemeData: function(hwnd: HWND;&nbsp;</font>
</font ></P>
<P><font face="Verdana" size="3">
<font face="Verdana" size="2">pszClassList: LPCWSTR): HTHEME; stdcall;</font>
</font ></P>
</blockquote>
<P><font face="Verdana" size="3">
возвращает дескриптор темы для текущего визуального стиля и класса, имя которого представлено параметром
<font face="Verdana" size="2">pszdassList</font>.
</font ></P>
<P><font face="Verdana" size="3">
После того как тема загружена, можно использовать разнообразные графические функции, входящие в состав программного интерфейса.
</font ></P>
<P><font face="Verdana" size="3">
При завершении работы не забудьте освободить занятые дескрипторы графического контекста и темы. Для темы используйте функцию
</font ></P>
<blockquote>
<P><font face="Verdana" size="3">
<font face="Verdana" size="2">
CloseThemeData: function(hTheme: HTHEME): HRESULT; stdcall;</font>
</font ></P>
</blockquote>
<P><font face="Verdana" size="3">
Заинтересованный читатель найдет подробное описание нужных функций Theme API в Microsoft MSDN или же может полюбопытствовать содержимым модулей UxTheme.pas и Themes.pas.
</font ></P>


<P><font face="Verdana" size="3">
&nbsp;
</font ></P>
<table COLS="3" WIDTH="16%">
<tr>
<td>
<font face="Verdana" size="3">
<a href="Index7.html">
<img SRC="Back.gif" BORDER="0">
</a>
</font>
</td>
<td WIDTH="10%">
<font face="Verdana" size="3">
<a href="../index.html">
<img SRC="Menu.gif" BORDER="0">
</a>
</font>
</td>
<td ALIGN="RIGHT">
<font face="Verdana" size="3">
<a href="Index9.html">
<img SRC="For.gif" BORDER="0">
</a>
</font>
</td>
</tr>
</table>
</body>
</html>
